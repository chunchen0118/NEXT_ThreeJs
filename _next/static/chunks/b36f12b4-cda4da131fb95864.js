"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[732],{8130:function(e,t,n){n.d(t,{CD:function(){return J},H5:function(){return ea},Qm:function(){return q},VB:function(){return z},YQ:function(){return O},gh:function(){return es},rk:function(){return $},w2:function(){return U},xC:function(){return _},xs:function(){return et}});var i,r,a,s=n(8138);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t,n,i){return(u="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,i){var r,a,s=c(e,t);if(s){if((a=Object.getOwnPropertyDescriptor(s,t)).set)return a.set.call(i,n),!0;if(!a.writable)return!1}if(a=Object.getOwnPropertyDescriptor(i,t)){if(!a.writable)return!1;a.value=n,Object.defineProperty(i,t,a)}else(r=T(r=t))in i?Object.defineProperty(i,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[r]=n;return!0})(e,t,n,i)}function l(){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=c(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function f(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=h(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw a}}}}function h(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function d(e,t,n){return t=p(t),function(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,!function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){return!1}}()?t.apply(e,n):Reflect.construct(t,n||[],p(e).constructor))}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}function m(e,t){return(m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function S(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,T(i.key),i)}}function x(e,t,n){return t&&S(e.prototype,t),n&&S(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function T(e){var t=function(e,t){if("object"!==o(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==o(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===o(t)?t:String(t)}var w=x(function e(){g(this,e),this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1},[{key:"autoReset",get:function(){return this._autoReset},set:function(e){"undefined"!=typeof document&&void 0!==document.hidden&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=e)}},{key:"delta",get:function(){return .001*this._delta}},{key:"fixedDelta",get:function(){return .001*this._fixedDelta},set:function(e){this._fixedDelta=1e3*e}},{key:"elapsed",get:function(){return .001*this._elapsed}},{key:"update",value:function(e){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(void 0!==e?e:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}},{key:"reset",value:function(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}},{key:"getDelta",value:function(){return this.delta}},{key:"getElapsed",value:function(){return this.elapsed}},{key:"handleEvent",value:function(e){document.hidden||(this.currentTime=performance.now()-this.startTime)}},{key:"dispose",value:function(){this.autoReset=!1}}]),k=(i=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),r=new Float32Array([0,0,2,0,0,2]),(a=new s.BufferGeometry).setAttribute("position",new s.BufferAttribute(i,3)),a.setAttribute("uv",new s.BufferAttribute(r,2)),a),U=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Pass",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Scene,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Camera;g(this,e),this.name=t,this.renderer=null,this.scene=n,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}return x(e,[{key:"renderToScreen",get:function(){return!this.rtt},set:function(e){if(this.rtt===e){var t=this.fullscreenMaterial;null!==t&&(t.needsUpdate=!0),this.rtt=!e}}},{key:"mainScene",set:function(e){}},{key:"mainCamera",set:function(e){}},{key:"setRenderer",value:function(e){this.renderer=e}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"fullscreenMaterial",get:function(){return null!==this.screen?this.screen.material:null},set:function(t){var n=this.screen;null!==n?n.material=t:((n=new s.Mesh(e.fullscreenGeometry,t)).frustumCulled=!1,null===this.scene&&(this.scene=new s.Scene),this.scene.add(n),this.screen=n)}},{key:"getFullscreenMaterial",value:function(){return this.fullscreenMaterial}},{key:"setFullscreenMaterial",value:function(e){this.fullscreenMaterial=e}},{key:"getDepthTexture",value:function(){return null}},{key:"setDepthTexture",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.BasicDepthPacking}},{key:"render",value:function(e,t,n,i,r){throw Error("Render method not implemented!")}},{key:"setSize",value:function(e,t){}},{key:"initialize",value:function(e,t,n){}},{key:"dispose",value:function(){for(var t=0,n=Object.keys(this);t<n.length;t++){var i=n[t],r=this[i];(r instanceof s.WebGLRenderTarget||r instanceof s.Material||r instanceof s.Texture||r instanceof e)&&this[i].dispose()}null!==this.fullscreenMaterial&&this.fullscreenMaterial.dispose()}}],[{key:"fullscreenGeometry",get:function(){return k}}])}(),E=function(e){function t(){var e;return g(this,t),(e=d(this,t,["ClearMaskPass",null,null])).needsSwap=!1,e}return y(t,e),x(t,[{key:"render",value:function(e,t,n,i,r){var a=e.state.buffers.stencil;a.setLocked(!1),a.setTest(!1)}}])}(U),b="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",B=function(e){function t(){return g(this,t),d(this,t,[{name:"CopyMaterial",uniforms:{inputBuffer:new s.Uniform(null),opacity:new s.Uniform(1)},blending:s.NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <colorspace_fragment>\n#include <dithering_fragment>\n}",vertexShader:b}])}return y(t,e),x(t,[{key:"inputBuffer",set:function(e){this.uniforms.inputBuffer.value=e}},{key:"setInputBuffer",value:function(e){this.uniforms.inputBuffer.value=e}},{key:"getOpacity",value:function(e){return this.uniforms.opacity.value}},{key:"setOpacity",value:function(e){this.uniforms.opacity.value=e}}])}(s.ShaderMaterial),R=function(e){function t(e){var n,i=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return g(this,t),(n=d(this,t,["CopyPass"])).fullscreenMaterial=new B,n.needsSwap=!1,n.renderTarget=e,void 0===e&&(n.renderTarget=new s.WebGLRenderTarget(1,1,{minFilter:s.LinearFilter,magFilter:s.LinearFilter,stencilBuffer:!1,depthBuffer:!1}),n.renderTarget.texture.name="CopyPass.Target"),n.autoResize=i,n}return y(t,e),x(t,[{key:"resize",get:function(){return this.autoResize},set:function(e){this.autoResize=e}},{key:"texture",get:function(){return this.renderTarget.texture}},{key:"getTexture",value:function(){return this.renderTarget.texture}},{key:"setAutoResizeEnabled",value:function(e){this.autoResize=e}},{key:"render",value:function(e,t,n,i,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}},{key:"setSize",value:function(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}},{key:"initialize",value:function(e,t,n){void 0!==n&&(this.renderTarget.texture.type=n,n!==s.UnsignedByteType?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":null!==e&&e.outputColorSpace===s.SRGBColorSpace&&(this.renderTarget.texture.colorSpace=s.SRGBColorSpace))}}])}(U),A=new s.Color,M=function(e){function t(){var e,n=!(arguments.length>0)||void 0===arguments[0]||arguments[0],i=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return g(this,t),(e=d(this,t,["ClearPass",null,null])).needsSwap=!1,e.color=n,e.depth=i,e.stencil=r,e.overrideClearColor=null,e.overrideClearAlpha=-1,e}return y(t,e),x(t,[{key:"setClearFlags",value:function(e,t,n){this.color=e,this.depth=t,this.stencil=n}},{key:"getOverrideClearColor",value:function(){return this.overrideClearColor}},{key:"setOverrideClearColor",value:function(e){this.overrideClearColor=e}},{key:"getOverrideClearAlpha",value:function(){return this.overrideClearAlpha}},{key:"setOverrideClearAlpha",value:function(e){this.overrideClearAlpha=e}},{key:"render",value:function(e,t,n,i,r){var a=this.overrideClearColor,s=this.overrideClearAlpha,o=e.getClearAlpha(),u=null!==a,l=s>=0;u?(e.getClearColor(A),e.setClearColor(a,l?s:o)):l&&e.setClearAlpha(s),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),u?e.setClearColor(A,o):l&&e.setClearAlpha(o)}}])}(U),D=function(e){function t(e,n){var i;return g(this,t),(i=d(this,t,["MaskPass",e,n])).needsSwap=!1,i.clearPass=new M(!1,!1,!0),i.inverse=!1,i}return y(t,e),x(t,[{key:"mainScene",set:function(e){this.scene=e}},{key:"mainCamera",set:function(e){this.camera=e}},{key:"inverted",get:function(){return this.inverse},set:function(e){this.inverse=e}},{key:"clear",get:function(){return this.clearPass.enabled},set:function(e){this.clearPass.enabled=e}},{key:"getClearPass",value:function(){return this.clearPass}},{key:"isInverted",value:function(){return this.inverted}},{key:"setInverted",value:function(e){this.inverted=e}},{key:"render",value:function(e,t,n,i,r){var a=e.getContext(),s=e.state.buffers,o=this.scene,u=this.camera,l=this.clearPass,c=this.inverted?0:1;s.color.setMask(!1),s.depth.setMask(!1),s.color.setLocked(!0),s.depth.setLocked(!0),s.stencil.setTest(!0),s.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),s.stencil.setFunc(a.ALWAYS,c,4294967295),s.stencil.setClear(1-c),s.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(e,null):(l.render(e,t),l.render(e,n))),this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),e.render(o,u),e.setRenderTarget(n)),e.render(o,u),s.color.setLocked(!1),s.depth.setLocked(!1),s.stencil.setLocked(!1),s.stencil.setFunc(a.EQUAL,1,4294967295),s.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),s.stencil.setLocked(!0)}}])}(U),_=x(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.depthBuffer,r=n.stencilBuffer,a=n.multisampling,s=n.frameBufferType;g(this,e),this.renderer=null,this.inputBuffer=this.createBuffer(void 0===i||i,void 0!==r&&r,s,void 0===a?0:a),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new R,this.depthTexture=null,this.passes=[],this.timer=new w,this.autoRenderToScreen=!0,this.setRenderer(t)},[{key:"multisampling",get:function(){return this.inputBuffer.samples||0},set:function(e){var t=this.inputBuffer,n=this.multisampling;n>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):n!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}},{key:"getTimer",value:function(){return this.timer}},{key:"getRenderer",value:function(){return this.renderer}},{key:"setRenderer",value:function(e){if(this.renderer=e,null!==e){var t=e.getSize(new s.Vector2),n=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===s.UnsignedByteType&&e.outputColorSpace===s.SRGBColorSpace&&(this.inputBuffer.texture.colorSpace=s.SRGBColorSpace,this.outputBuffer.texture.colorSpace=s.SRGBColorSpace,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);var r,a=f(this.passes);try{for(a.s();!(r=a.n()).done;)r.value.initialize(e,n,i)}catch(e){a.e(e)}finally{a.f()}}}},{key:"replaceRenderer",value:function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=this.renderer,i=n.domElement.parentNode;return this.setRenderer(e),t&&null!==i&&(i.removeChild(n.domElement),i.appendChild(e.domElement)),n}},{key:"createDepthTexture",value:function(){var e=this.depthTexture=new s.DepthTexture;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=s.DepthStencilFormat,e.type=s.UnsignedInt248Type):e.type=s.UnsignedIntType,e}},{key:"deleteDepthTexture",value:function(){if(null!==this.depthTexture){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();var e,t=f(this.passes);try{for(t.s();!(e=t.n()).done;)e.value.setDepthTexture(null)}catch(e){t.e(e)}finally{t.f()}}}},{key:"createBuffer",value:function(e,t,n,i){var r=this.renderer,a=null===r?new s.Vector2:r.getDrawingBufferSize(new s.Vector2),o={minFilter:s.LinearFilter,magFilter:s.LinearFilter,stencilBuffer:t,depthBuffer:e,type:n},u=new s.WebGLRenderTarget(a.width,a.height,o);return i>0&&(u.ignoreDepthForMultisampleCopy=!1,u.samples=i),n===s.UnsignedByteType&&null!==r&&r.outputColorSpace===s.SRGBColorSpace&&(u.texture.colorSpace=s.SRGBColorSpace),u.texture.name="EffectComposer.Buffer",u.texture.generateMipmaps=!1,u}},{key:"setMainScene",value:function(e){var t,n=f(this.passes);try{for(n.s();!(t=n.n()).done;)t.value.mainScene=e}catch(e){n.e(e)}finally{n.f()}}},{key:"setMainCamera",value:function(e){var t,n=f(this.passes);try{for(n.s();!(t=n.n()).done;)t.value.mainCamera=e}catch(e){n.e(e)}finally{n.f()}}},{key:"addPass",value:function(e,t){var n=this.passes,i=this.renderer,r=i.getDrawingBufferSize(new s.Vector2),a=i.getContext().getContextAttributes().alpha,o=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(r.width,r.height),e.initialize(i,a,o),this.autoRenderToScreen&&(n.length>0&&(n[n.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==t?n.splice(t,0,e):n.push(e),this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!0),e.needsDepthTexture||null!==this.depthTexture){if(null===this.depthTexture){var u,l=this.createDepthTexture(),c=f(n);try{for(c.s();!(u=c.n()).done;)(e=u.value).setDepthTexture(l)}catch(e){c.e(e)}finally{c.f()}}else e.setDepthTexture(this.depthTexture)}}},{key:"removePass",value:function(e){var t=this.passes,n=t.indexOf(e);-1!==n&&t.splice(n,1).length>0&&(null===this.depthTexture||t.reduce(function(e,t){return e||t.needsDepthTexture},!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture()),this.autoRenderToScreen&&n===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0)))}},{key:"removeAllPasses",value:function(){var e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}},{key:"render",value:function(e){var t=this.renderer,n=this.copyPass,i=this.inputBuffer,r=this.outputBuffer,a=!1;void 0===e&&(this.timer.update(),e=this.timer.getDelta());var s,o,u,l,c=f(this.passes);try{for(c.s();!(l=c.n()).done;){var h=l.value;h.enabled&&(h.render(t,i,r,e,a),h.needsSwap&&(a&&(n.renderToScreen=h.renderToScreen,s=t.getContext(),(o=t.state.buffers.stencil).setFunc(s.NOTEQUAL,1,4294967295),n.render(t,i,r,e,a),o.setFunc(s.EQUAL,1,4294967295)),u=i,i=r,r=u),h instanceof D?a=!0:h instanceof E&&(a=!1))}}catch(e){c.e(e)}finally{c.f()}}},{key:"setSize",value:function(e,t,n){var i=this.renderer,r=i.getSize(new s.Vector2);(void 0===e||void 0===t)&&(e=r.width,t=r.height),(r.width!==e||r.height!==t)&&i.setSize(e,t,n);var a=i.getDrawingBufferSize(new s.Vector2);this.inputBuffer.setSize(a.width,a.height),this.outputBuffer.setSize(a.width,a.height);var o,u=f(this.passes);try{for(u.s();!(o=u.n()).done;)o.value.setSize(a.width,a.height)}catch(e){u.e(e)}finally{u.f()}}},{key:"reset",value:function(){this.dispose(),this.autoRenderToScreen=!0}},{key:"dispose",value:function(){var e,t=f(this.passes);try{for(t.s();!(e=t.n()).done;)e.value.dispose()}catch(e){t.e(e)}finally{t.f()}this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),U.fullscreenGeometry.dispose()}}]),z={NONE:0,DEPTH:1,CONVOLUTION:2},C={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},F=x(function e(){g(this,e),this.shaderParts=new Map([[C.FRAGMENT_HEAD,null],[C.FRAGMENT_MAIN_UV,null],[C.FRAGMENT_MAIN_IMAGE,null],[C.VERTEX_HEAD,null],[C.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=z.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=s.LinearSRGBColorSpace}),P=!1,I=x(function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;g(this,e),this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=function(e){if(e.isMesh){var n;if(e.material.flatShading)switch(e.material.side){case s.DoubleSide:n=t.materialsFlatShadedDoubleSide;break;case s.BackSide:n=t.materialsFlatShadedBackSide;break;default:n=t.materialsFlatShaded}else switch(e.material.side){case s.DoubleSide:n=t.materialsDoubleSide;break;case s.BackSide:n=t.materialsBackSide;break;default:n=t.materials}t.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=n[2]:e.isInstancedMesh?e.material=n[1]:e.material=n[0],++t.meshCount}}},[{key:"cloneMaterial",value:function(e){if(!(e instanceof s.ShaderMaterial))return e.clone();var t=e.uniforms,n=new Map;for(var i in t){var r=t[i].value;r.isRenderTargetTexture&&(t[i].value=null,n.set(i,r))}var a,o=e.clone(),u=f(n);try{for(u.s();!(a=u.n()).done;){var l=a.value;t[l[0]].value=l[1],o.uniforms[l[0]].value=l[1]}}catch(e){u.e(e)}finally{u.f()}return o}},{key:"setMaterial",value:function(e){var t=this;if(this.disposeMaterials(),this.material=e,null!==e){for(var n=this.materials=[this.cloneMaterial(e),this.cloneMaterial(e),this.cloneMaterial(e)],i=0;i<n.length;i++){var r=n[i];r.uniforms=Object.assign({},e.uniforms),r.side=s.FrontSide}n[2].skinning=!0,this.materialsBackSide=n.map(function(n){var i=t.cloneMaterial(n);return i.uniforms=Object.assign({},e.uniforms),i.side=s.BackSide,i}),this.materialsDoubleSide=n.map(function(n){var i=t.cloneMaterial(n);return i.uniforms=Object.assign({},e.uniforms),i.side=s.DoubleSide,i}),this.materialsFlatShaded=n.map(function(n){var i=t.cloneMaterial(n);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=n.map(function(n){var i=t.cloneMaterial(n);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=s.BackSide,i}),this.materialsFlatShadedDoubleSide=n.map(function(n){var i=t.cloneMaterial(n);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=s.DoubleSide,i})}}},{key:"render",value:function(e,t,n){var i=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,P){var r=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,n);var a,s=f(r);try{for(s.s();!(a=s.n()).done;){var o=a.value;o[0].material=o[1]}}catch(e){s.e(e)}finally{s.f()}this.meshCount!==r.size&&r.clear()}else{var u=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,n),t.overrideMaterial=u}e.shadowMap.enabled=i}},{key:"disposeMaterials",value:function(){if(null!==this.material){var e,t=f(this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide));try{for(t.s();!(e=t.n()).done;)e.value.dispose()}catch(e){t.e(e)}finally{t.f()}}}},{key:"dispose",value:function(){this.originalMaterials.clear(),this.disposeMaterials()}}],[{key:"workaroundEnabled",get:function(){return P},set:function(e){P=e}}]),N=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return g(this,t),(n=d(this,t)).resizable=e,n.baseSize=new s.Vector2(1,1),n.preferredSize=new s.Vector2(i,r),n.target=n.preferredSize,n.s=a,n.effectiveSize=new s.Vector2,n.addEventListener("change",function(){return n.updateEffectiveSize()}),n.updateEffectiveSize(),n}return y(t,e),x(t,[{key:"updateEffectiveSize",value:function(){var e=this.baseSize,t=this.preferredSize,n=this.effectiveSize,i=this.scale;-1!==t.width?n.width=t.width:-1!==t.height?n.width=Math.round(t.height*(e.width/Math.max(e.height,1))):n.width=Math.round(e.width*i),-1!==t.height?n.height=t.height:-1!==t.width?n.height=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):n.height=Math.round(e.height*i)}},{key:"width",get:function(){return this.effectiveSize.width},set:function(e){this.preferredWidth=e}},{key:"height",get:function(){return this.effectiveSize.height},set:function(e){this.preferredHeight=e}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"scale",get:function(){return this.s},set:function(e){this.s!==e&&(this.s=e,this.preferredSize.setScalar(-1),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}},{key:"getScale",value:function(){return this.scale}},{key:"setScale",value:function(e){this.scale=e}},{key:"baseWidth",get:function(){return this.baseSize.width},set:function(e){this.baseSize.width!==e&&(this.baseSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}},{key:"getBaseWidth",value:function(){return this.baseWidth}},{key:"setBaseWidth",value:function(e){this.baseWidth=e}},{key:"baseHeight",get:function(){return this.baseSize.height},set:function(e){this.baseSize.height!==e&&(this.baseSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}},{key:"getBaseHeight",value:function(){return this.baseHeight}},{key:"setBaseHeight",value:function(e){this.baseHeight=e}},{key:"setBaseSize",value:function(e,t){(this.baseSize.width!==e||this.baseSize.height!==t)&&(this.baseSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}},{key:"preferredWidth",get:function(){return this.preferredSize.width},set:function(e){this.preferredSize.width!==e&&(this.preferredSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}},{key:"getPreferredWidth",value:function(){return this.preferredWidth}},{key:"setPreferredWidth",value:function(e){this.preferredWidth=e}},{key:"preferredHeight",get:function(){return this.preferredSize.height},set:function(e){this.preferredSize.height!==e&&(this.preferredSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}},{key:"getPreferredHeight",value:function(){return this.preferredHeight}},{key:"setPreferredHeight",value:function(e){this.preferredHeight=e}},{key:"setPreferredSize",value:function(e,t){(this.preferredSize.width!==e||this.preferredSize.height!==t)&&(this.preferredSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}},{key:"copy",value:function(e){this.s=e.scale,this.baseSize.set(e.baseWidth,e.baseHeight),this.preferredSize.set(e.preferredWidth,e.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}}],[{key:"AUTO_SIZE",get:function(){return -1}}])}(s.EventDispatcher),O={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},G=new Map([[O.ADD,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}"],[O.ALPHA,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}"],[O.AVERAGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}"],[O.COLOR,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[O.COLOR_BURN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}"],[O.COLOR_DODGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}"],[O.DARKEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}"],[O.DIFFERENCE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}"],[O.DIVIDE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}"],[O.DST,null],[O.EXCLUSION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}"],[O.HARD_LIGHT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}"],[O.HARD_MIX,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}"],[O.HUE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}"],[O.INVERT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}"],[O.INVERT_RGB,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}"],[O.LIGHTEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}"],[O.LINEAR_BURN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}"],[O.LINEAR_DODGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}"],[O.LINEAR_LIGHT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}"],[O.LUMINOSITY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[O.MULTIPLY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}"],[O.NEGATION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}"],[O.NORMAL,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}"],[O.OVERLAY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}"],[O.PIN_LIGHT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}"],[O.REFLECT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}"],[O.SATURATION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}"],[O.SCREEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}"],[O.SOFT_LIGHT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}"],[O.SRC,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}"],[O.SUBTRACT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}"],[O.VIVID_LIGHT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}"]]),H=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return g(this,t),(n=d(this,t))._blendFunction=e,n.opacity=new s.Uniform(i),n}return y(t,e),x(t,[{key:"getOpacity",value:function(){return this.opacity.value}},{key:"setOpacity",value:function(e){this.opacity.value=e}},{key:"blendFunction",get:function(){return this._blendFunction},set:function(e){this._blendFunction=e,this.dispatchEvent({type:"change"})}},{key:"getBlendFunction",value:function(){return this.blendFunction}},{key:"setBlendFunction",value:function(e){this.blendFunction=e}},{key:"getShaderCode",value:function(){return G.get(this.blendFunction)}}])}(s.EventDispatcher),L={MEDIUM:2,LARGE:3},V=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],W=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new s.Vector4;return g(this,t),(e=d(this,t,[{name:"KawaseBlurMaterial",uniforms:{inputBuffer:new s.Uniform(null),texelSize:new s.Uniform(new s.Vector4),scale:new s.Uniform(1),kernel:new s.Uniform(0)},blending:s.NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}])).setTexelSize(n.x,n.y),e.kernelSize=L.MEDIUM,e}return y(t,e),x(t,[{key:"inputBuffer",set:function(e){this.uniforms.inputBuffer.value=e}},{key:"setInputBuffer",value:function(e){this.inputBuffer=e}},{key:"kernelSequence",get:function(){return V[this.kernelSize]}},{key:"scale",get:function(){return this.uniforms.scale.value},set:function(e){this.uniforms.scale.value=e}},{key:"getScale",value:function(){return this.uniforms.scale.value}},{key:"setScale",value:function(e){this.uniforms.scale.value=e}},{key:"getKernel",value:function(){return null}},{key:"kernel",get:function(){return this.uniforms.kernel.value},set:function(e){this.uniforms.kernel.value=e}},{key:"setKernel",value:function(e){this.kernel=e}},{key:"setTexelSize",value:function(e,t){this.uniforms.texelSize.value.set(e,t,.5*e,.5*t)}},{key:"setSize",value:function(e,t){var n=1/e,i=1/t;this.uniforms.texelSize.value.set(n,i,.5*n,.5*i)}}])}(s.ShaderMaterial),j=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.kernelSize,r=void 0===i?L.MEDIUM:i,a=n.resolutionScale,o=n.width,u=void 0===o?N.AUTO_SIZE:o,l=n.height,c=void 0===l?N.AUTO_SIZE:l,f=n.resolutionX,h=n.resolutionY;g(this,t),(e=d(this,t,["KawaseBlurPass"])).renderTargetA=new s.WebGLRenderTarget(1,1,{depthBuffer:!1}),e.renderTargetA.texture.name="Blur.Target.A",e.renderTargetB=e.renderTargetA.clone(),e.renderTargetB.texture.name="Blur.Target.B";var v=e.resolution=new N(e,void 0===f?u:f,void 0===h?c:h,void 0===a?.5:a);return v.addEventListener("change",function(t){return e.setSize(v.baseWidth,v.baseHeight)}),e._blurMaterial=new W,e._blurMaterial.kernelSize=r,e.copyMaterial=new B,e}return y(t,e),x(t,[{key:"getResolution",value:function(){return this.resolution}},{key:"blurMaterial",get:function(){return this._blurMaterial},set:function(e){this._blurMaterial=e}},{key:"dithering",get:function(){return this.copyMaterial.dithering},set:function(e){this.copyMaterial.dithering=e}},{key:"kernelSize",get:function(){return this.blurMaterial.kernelSize},set:function(e){this.blurMaterial.kernelSize=e}},{key:"width",get:function(){return this.resolution.width},set:function(e){this.resolution.preferredWidth=e}},{key:"height",get:function(){return this.resolution.height},set:function(e){this.resolution.preferredHeight=e}},{key:"scale",get:function(){return this.blurMaterial.scale},set:function(e){this.blurMaterial.scale=e}},{key:"getScale",value:function(){return this.blurMaterial.scale}},{key:"setScale",value:function(e){this.blurMaterial.scale=e}},{key:"getKernelSize",value:function(){return this.kernelSize}},{key:"setKernelSize",value:function(e){this.kernelSize=e}},{key:"getResolutionScale",value:function(){return this.resolution.scale}},{key:"setResolutionScale",value:function(e){this.resolution.scale=e}},{key:"render",value:function(e,t,n,i,r){var a=this.scene,s=this.camera,o=this.renderTargetA,u=this.renderTargetB,l=this.blurMaterial,c=l.kernelSequence,f=t;this.fullscreenMaterial=l;for(var h=0,v=c.length;h<v;++h){var d=(1&h)==0?o:u;l.kernel=c[h],l.inputBuffer=f.texture,e.setRenderTarget(d),e.render(a,s),f=d}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=f.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(a,s)}},{key:"setSize",value:function(e,t){var n=this.resolution;n.setBaseSize(e,t);var i=n.width,r=n.height;this.renderTargetA.setSize(i,r),this.renderTargetB.setSize(i,r),this.blurMaterial.setSize(e,t)}},{key:"initialize",value:function(e,t,n){void 0!==n&&(this.renderTargetA.texture.type=n,this.renderTargetB.texture.type=n,n!==s.UnsignedByteType?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):null!==e&&e.outputColorSpace===s.SRGBColorSpace&&(this.renderTargetA.texture.colorSpace=s.SRGBColorSpace,this.renderTargetB.texture.colorSpace=s.SRGBColorSpace))}}],[{key:"AUTO_SIZE",get:function(){return N.AUTO_SIZE}}])}(U),X=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return g(this,t),(e=d(this,t,[{name:"LuminanceMaterial",defines:{THREE_REVISION:s.REVISION.replace(/\D+/g,"")},uniforms:{inputBuffer:new s.Uniform(null),threshold:new s.Uniform(0),smoothing:new s.Uniform(1),range:new s.Uniform(null)},blending:s.NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l)*l;\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}",vertexShader:b}])).colorOutput=n,e.luminanceRange=i,e}return y(t,e),x(t,[{key:"inputBuffer",set:function(e){this.uniforms.inputBuffer.value=e}},{key:"setInputBuffer",value:function(e){this.uniforms.inputBuffer.value=e}},{key:"threshold",get:function(){return this.uniforms.threshold.value},set:function(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}},{key:"getThreshold",value:function(){return this.threshold}},{key:"setThreshold",value:function(e){this.threshold=e}},{key:"smoothing",get:function(){return this.uniforms.smoothing.value},set:function(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}},{key:"getSmoothingFactor",value:function(){return this.smoothing}},{key:"setSmoothingFactor",value:function(e){this.smoothing=e}},{key:"useThreshold",get:function(){return this.threshold>0||this.smoothing>0},set:function(e){}},{key:"colorOutput",get:function(){return void 0!==this.defines.COLOR},set:function(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}},{key:"isColorOutputEnabled",value:function(e){return this.colorOutput}},{key:"setColorOutputEnabled",value:function(e){this.colorOutput=e}},{key:"useRange",get:function(){return null!==this.luminanceRange},set:function(e){this.luminanceRange=null}},{key:"luminanceRange",get:function(){return this.uniforms.range.value},set:function(e){null!==e?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}},{key:"getLuminanceRange",value:function(){return this.luminanceRange}},{key:"setLuminanceRange",value:function(e){this.luminanceRange=e}}])}(s.ShaderMaterial),K=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.renderTarget,r=n.luminanceRange,a=n.colorOutput,o=n.resolutionScale,u=n.width,l=void 0===u?N.AUTO_SIZE:u,c=n.height,f=void 0===c?N.AUTO_SIZE:c,h=n.resolutionX,v=n.resolutionY;g(this,t),(e=d(this,t,["LuminancePass"])).fullscreenMaterial=new X(a,r),e.needsSwap=!1,e.renderTarget=i,void 0===e.renderTarget&&(e.renderTarget=new s.WebGLRenderTarget(1,1,{depthBuffer:!1}),e.renderTarget.texture.name="LuminancePass.Target");var p=e.resolution=new N(e,void 0===h?l:h,void 0===v?f:v,void 0===o?1:o);return p.addEventListener("change",function(t){return e.setSize(p.baseWidth,p.baseHeight)}),e}return y(t,e),x(t,[{key:"texture",get:function(){return this.renderTarget.texture}},{key:"getTexture",value:function(){return this.renderTarget.texture}},{key:"getResolution",value:function(){return this.resolution}},{key:"render",value:function(e,t,n,i,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}},{key:"setSize",value:function(e,t){var n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}},{key:"initialize",value:function(e,t,n){void 0!==n&&n!==s.UnsignedByteType&&(this.renderTarget.texture.type=n,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}}])}(U),Z=function(e){function t(){return g(this,t),d(this,t,[{name:"DownsamplingMaterial",uniforms:{inputBuffer:new s.Uniform(null),texelSize:new s.Uniform(new s.Vector2)},blending:s.NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#define WEIGHT_INNER 0.125\n#define WEIGHT_OUTER 0.0555555\nvarying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}"}])}return y(t,e),x(t,[{key:"inputBuffer",set:function(e){this.uniforms.inputBuffer.value=e}},{key:"setSize",value:function(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}}])}(s.ShaderMaterial),Y=function(e){function t(){return g(this,t),d(this,t,[{name:"UpsamplingMaterial",uniforms:{inputBuffer:new s.Uniform(null),supportBuffer:new s.Uniform(null),texelSize:new s.Uniform(new s.Vector2),radius:new s.Uniform(.85)},blending:s.NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;\n#else\nuniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;\n#endif\nuniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);\n#include <colorspace_fragment>\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}"}])}return y(t,e),x(t,[{key:"inputBuffer",set:function(e){this.uniforms.inputBuffer.value=e}},{key:"supportBuffer",set:function(e){this.uniforms.supportBuffer.value=e}},{key:"radius",get:function(){return this.uniforms.radius.value},set:function(e){this.uniforms.radius.value=e}},{key:"setSize",value:function(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}}])}(s.ShaderMaterial),Q=function(e){function t(){var e;return g(this,t),(e=d(this,t,["MipmapBlurPass"])).needsSwap=!1,e.renderTarget=new s.WebGLRenderTarget(1,1,{depthBuffer:!1}),e.renderTarget.texture.name="Upsampling.Mipmap0",e.downsamplingMipmaps=[],e.upsamplingMipmaps=[],e.downsamplingMaterial=new Z,e.upsamplingMaterial=new Y,e.resolution=new s.Vector2,e}return y(t,e),x(t,[{key:"texture",get:function(){return this.renderTarget.texture}},{key:"levels",get:function(){return this.downsamplingMipmaps.length},set:function(e){if(this.levels!==e){var t=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(var n=0;n<e;++n){var i=t.clone();i.texture.name="Downsampling.Mipmap"+n,this.downsamplingMipmaps.push(i)}this.upsamplingMipmaps.push(t);for(var r=1,a=e-1;r<a;++r){var s=t.clone();s.texture.name="Upsampling.Mipmap"+r,this.upsamplingMipmaps.push(s)}this.setSize(this.resolution.x,this.resolution.y)}}},{key:"radius",get:function(){return this.upsamplingMaterial.radius},set:function(e){this.upsamplingMaterial.radius=e}},{key:"render",value:function(e,t,n,i,r){var a=this.scene,s=this.camera,o=this.downsamplingMaterial,u=this.upsamplingMaterial,l=this.downsamplingMipmaps,c=this.upsamplingMipmaps,f=t;this.fullscreenMaterial=o;for(var h=0,v=l.length;h<v;++h){var d=l[h];o.setSize(f.width,f.height),o.inputBuffer=f.texture,e.setRenderTarget(d),e.render(a,s),f=d}this.fullscreenMaterial=u;for(var p=c.length-1;p>=0;--p){var y=c[p];u.setSize(f.width,f.height),u.inputBuffer=f.texture,u.supportBuffer=l[p].texture,e.setRenderTarget(y),e.render(a,s),f=y}}},{key:"setSize",value:function(e,t){var n=this.resolution;n.set(e,t);for(var i=n.width,r=n.height,a=0,s=this.downsamplingMipmaps.length;a<s;++a)i=Math.round(.5*i),r=Math.round(.5*r),this.downsamplingMipmaps[a].setSize(i,r),a<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[a].setSize(i,r)}},{key:"initialize",value:function(e,t,n){if(void 0!==n){var i,r=this.downsamplingMipmaps.concat(this.upsamplingMipmaps),a=f(r);try{for(a.s();!(i=a.n()).done;)i.value.texture.type=n}catch(e){a.e(e)}finally{a.f()}if(n!==s.UnsignedByteType)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(null!==e&&e.outputColorSpace===s.SRGBColorSpace){var o,u=f(r);try{for(u.s();!(o=u.n()).done;)o.value.texture.colorSpace=s.SRGBColorSpace}catch(e){u.e(e)}finally{u.f()}}}}},{key:"dispose",value:function(){l(p(t.prototype),"dispose",this).call(this);var e,n=f(this.downsamplingMipmaps.concat(this.upsamplingMipmaps));try{for(n.s();!(e=n.n()).done;)e.value.dispose()}catch(e){n.e(e)}finally{n.f()}}}])}(U),q=function(e){function t(e,n){var i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.attributes,o=void 0===a?z.NONE:a,u=r.blendFunction,l=void 0===u?O.NORMAL:u,c=r.defines,f=void 0===c?new Map:c,h=r.uniforms,v=void 0===h?new Map:h,p=r.extensions,y=r.vertexShader;return g(this,t),(i=d(this,t)).name=e,i.renderer=null,i.attributes=o,i.fragmentShader=n,i.vertexShader=void 0===y?null:y,i.defines=f,i.uniforms=v,i.extensions=void 0===p?null:p,i.blendMode=new H(l),i.blendMode.addEventListener("change",function(e){return i.setChanged()}),i._inputColorSpace=s.LinearSRGBColorSpace,i._outputColorSpace=s.NoColorSpace,i}return y(t,e),x(t,[{key:"inputColorSpace",get:function(){return this._inputColorSpace},set:function(e){this._inputColorSpace=e,this.setChanged()}},{key:"outputColorSpace",get:function(){return this._outputColorSpace},set:function(e){this._outputColorSpace=e,this.setChanged()}},{key:"mainScene",set:function(e){}},{key:"mainCamera",set:function(e){}},{key:"getName",value:function(){return this.name}},{key:"setRenderer",value:function(e){this.renderer=e}},{key:"getDefines",value:function(){return this.defines}},{key:"getUniforms",value:function(){return this.uniforms}},{key:"getExtensions",value:function(){return this.extensions}},{key:"getBlendMode",value:function(){return this.blendMode}},{key:"getAttributes",value:function(){return this.attributes}},{key:"setAttributes",value:function(e){this.attributes=e,this.setChanged()}},{key:"getFragmentShader",value:function(){return this.fragmentShader}},{key:"setFragmentShader",value:function(e){this.fragmentShader=e,this.setChanged()}},{key:"getVertexShader",value:function(){return this.vertexShader}},{key:"setVertexShader",value:function(e){this.vertexShader=e,this.setChanged()}},{key:"setChanged",value:function(){this.dispatchEvent({type:"change"})}},{key:"setDepthTexture",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.BasicDepthPacking}},{key:"update",value:function(e,t,n){}},{key:"setSize",value:function(e,t){}},{key:"initialize",value:function(e,t,n){}},{key:"dispose",value:function(){for(var e=0,t=Object.keys(this);e<t.length;e++){var n=t[e],i=this[n];(i instanceof s.WebGLRenderTarget||i instanceof s.Material||i instanceof s.Texture||i instanceof U)&&this[n].dispose()}}}])}(s.EventDispatcher),$=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.blendFunction,r=void 0===i?O.SCREEN:i,a=n.luminanceThreshold,o=n.luminanceSmoothing,u=n.mipmapBlur,l=void 0!==u&&u,c=n.intensity,f=n.radius,h=n.levels,v=n.kernelSize,p=void 0===v?L.LARGE:v,y=n.resolutionScale,m=n.width,S=void 0===m?N.AUTO_SIZE:m,x=n.height,T=void 0===x?N.AUTO_SIZE:x,w=n.resolutionX,k=n.resolutionY;g(this,t),(e=d(this,t,["BloomEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}",{blendFunction:r,uniforms:new Map([["map",new s.Uniform(null)],["intensity",new s.Uniform(void 0===c?1:c)]])}])).renderTarget=new s.WebGLRenderTarget(1,1,{depthBuffer:!1}),e.renderTarget.texture.name="Bloom.Target",e.blurPass=new j({kernelSize:p}),e.luminancePass=new K({colorOutput:!0}),e.luminanceMaterial.threshold=void 0===a?.9:a,e.luminanceMaterial.smoothing=void 0===o?.025:o,e.mipmapBlurPass=new Q,e.mipmapBlurPass.enabled=l,e.mipmapBlurPass.radius=void 0===f?.85:f,e.mipmapBlurPass.levels=void 0===h?8:h,e.uniforms.get("map").value=l?e.mipmapBlurPass.texture:e.renderTarget.texture;var U=e.resolution=new N(e,void 0===w?S:w,void 0===k?T:k,void 0===y?.5:y);return U.addEventListener("change",function(t){return e.setSize(U.baseWidth,U.baseHeight)}),e}return y(t,e),x(t,[{key:"texture",get:function(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}},{key:"getTexture",value:function(){return this.texture}},{key:"getResolution",value:function(){return this.resolution}},{key:"getBlurPass",value:function(){return this.blurPass}},{key:"getLuminancePass",value:function(){return this.luminancePass}},{key:"luminanceMaterial",get:function(){return this.luminancePass.fullscreenMaterial}},{key:"getLuminanceMaterial",value:function(){return this.luminancePass.fullscreenMaterial}},{key:"width",get:function(){return this.resolution.width},set:function(e){this.resolution.preferredWidth=e}},{key:"height",get:function(){return this.resolution.height},set:function(e){this.resolution.preferredHeight=e}},{key:"dithering",get:function(){return this.blurPass.dithering},set:function(e){this.blurPass.dithering=e}},{key:"kernelSize",get:function(){return this.blurPass.kernelSize},set:function(e){this.blurPass.kernelSize=e}},{key:"distinction",get:function(){return console.warn(this.name,"distinction was removed"),1},set:function(e){console.warn(this.name,"distinction was removed")}},{key:"intensity",get:function(){return this.uniforms.get("intensity").value},set:function(e){this.uniforms.get("intensity").value=e}},{key:"getIntensity",value:function(){return this.intensity}},{key:"setIntensity",value:function(e){this.intensity=e}},{key:"getResolutionScale",value:function(){return this.resolution.scale}},{key:"setResolutionScale",value:function(e){this.resolution.scale=e}},{key:"update",value:function(e,t,n){var i=this.renderTarget,r=this.luminancePass;r.enabled?(r.render(e,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,r.renderTarget):this.blurPass.render(e,r.renderTarget,i)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,t):this.blurPass.render(e,t,i)}},{key:"setSize",value:function(e,t){var n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height),this.blurPass.resolution.copy(n),this.luminancePass.setSize(e,t),this.mipmapBlurPass.setSize(e,t)}},{key:"initialize",value:function(e,t,n){this.blurPass.initialize(e,t,n),this.luminancePass.initialize(e,t,n),this.mipmapBlurPass.initialize(e,t,n),void 0!==n&&(this.renderTarget.texture.type=n,null!==e&&e.outputColorSpace===s.SRGBColorSpace&&(this.renderTarget.texture.colorSpace=s.SRGBColorSpace))}}])}(q),J=function(e){function t(e,n){var i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return g(this,t),(i=d(this,t,["RenderPass",e,n])).needsSwap=!1,i.clearPass=new M,i.overrideMaterialManager=null===r?null:new I(r),i.ignoreBackground=!1,i.skipShadowMapUpdate=!1,i.selection=null,i}return y(t,e),x(t,[{key:"mainScene",set:function(e){this.scene=e}},{key:"mainCamera",set:function(e){this.camera=e}},{key:"renderToScreen",get:function(){return l(p(t.prototype),"renderToScreen",this)},set:function(e){(function(e,t,n,i,r){if(!u(e,t,n,i||e)&&r)throw TypeError("failed to set property")})(p(t.prototype),"renderToScreen",e,this,!0),this.clearPass.renderToScreen=e}},{key:"overrideMaterial",get:function(){var e=this.overrideMaterialManager;return null!==e?e.material:null},set:function(e){var t=this.overrideMaterialManager;null!==e?null!==t?t.setMaterial(e):this.overrideMaterialManager=new I(e):null!==t&&(t.dispose(),this.overrideMaterialManager=null)}},{key:"getOverrideMaterial",value:function(){return this.overrideMaterial}},{key:"setOverrideMaterial",value:function(e){this.overrideMaterial=e}},{key:"clear",get:function(){return this.clearPass.enabled},set:function(e){this.clearPass.enabled=e}},{key:"getSelection",value:function(){return this.selection}},{key:"setSelection",value:function(e){this.selection=e}},{key:"isBackgroundDisabled",value:function(){return this.ignoreBackground}},{key:"setBackgroundDisabled",value:function(e){this.ignoreBackground=e}},{key:"isShadowMapDisabled",value:function(){return this.skipShadowMapUpdate}},{key:"setShadowMapDisabled",value:function(e){this.skipShadowMapUpdate=e}},{key:"getClearPass",value:function(){return this.clearPass}},{key:"render",value:function(e,t,n,i,r){var a=this.scene,s=this.camera,o=this.selection,u=s.layers.mask,l=a.background,c=e.shadowMap.autoUpdate,f=this.renderToScreen?null:t;null!==o&&s.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||null!==this.clearPass.overrideClearColor)&&(a.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(f),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(e,a,s):e.render(a,s),s.layers.mask=u,a.background=l,e.shadowMap.autoUpdate=c}}])}(U),ee=function(e){function t(){return g(this,t),d(this,t,[{name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new s.Uniform(null),normalBuffer:new s.Uniform(null),texelSize:new s.Uniform(new s.Vector2)},blending:s.NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:"#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\n#ifdef DOWNSAMPLE_NORMALS\nuniform lowp sampler2D normalBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);\n#ifdef DOWNSAMPLE_NORMALS\nvec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;\n#else\nvec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);\n#endif\ngl_FragColor=vec4(n[index],d[index]);}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}"}])}return y(t,e),x(t,[{key:"depthBuffer",set:function(e){this.uniforms.depthBuffer.value=e}},{key:"depthPacking",set:function(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}},{key:"setDepthBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.BasicDepthPacking;this.depthBuffer=e,this.depthPacking=t}},{key:"normalBuffer",set:function(e){this.uniforms.normalBuffer.value=e,null!==e?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}},{key:"setNormalBuffer",value:function(e){this.normalBuffer=e}},{key:"setTexelSize",value:function(e,t){this.uniforms.texelSize.value.set(e,t)}},{key:"setSize",value:function(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}}])}(s.ShaderMaterial),et=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.normalBuffer,r=n.resolutionScale,a=n.width,o=void 0===a?N.AUTO_SIZE:a,u=n.height,l=void 0===u?N.AUTO_SIZE:u,c=n.resolutionX,f=n.resolutionY;g(this,t),e=d(this,t,["DepthDownsamplingPass"]);var h=new ee;h.normalBuffer=void 0===i?null:i,e.fullscreenMaterial=h,e.needsDepthTexture=!0,e.needsSwap=!1,e.renderTarget=new s.WebGLRenderTarget(1,1,{minFilter:s.NearestFilter,magFilter:s.NearestFilter,depthBuffer:!1,type:s.FloatType}),e.renderTarget.texture.name="DepthDownsamplingPass.Target",e.renderTarget.texture.generateMipmaps=!1;var v=e.resolution=new N(e,void 0===c?o:c,void 0===f?l:f,void 0===r?.5:r);return v.addEventListener("change",function(t){return e.setSize(v.baseWidth,v.baseHeight)}),e}return y(t,e),x(t,[{key:"texture",get:function(){return this.renderTarget.texture}},{key:"getTexture",value:function(){return this.renderTarget.texture}},{key:"getResolution",value:function(){return this.resolution}},{key:"setDepthTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.BasicDepthPacking;this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t}},{key:"render",value:function(e,t,n,i,r){e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}},{key:"setSize",value:function(e,t){var n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height),this.fullscreenMaterial.setSize(e,t)}},{key:"initialize",value:function(e,t,n){var i=e.getContext();if(!(i.getExtension("EXT_color_buffer_float")||i.getExtension("EXT_color_buffer_half_float")))throw Error("Rendering to float texture is not supported.")}}])}(U),en=function(e){function t(e,n,i,r){var a,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return g(this,t),a=d(this,t,[{name:"EffectMaterial",defines:{THREE_REVISION:s.REVISION.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new s.Uniform(null),depthBuffer:new s.Uniform(null),resolution:new s.Uniform(new s.Vector2),texelSize:new s.Uniform(new s.Vector2),cameraNear:new s.Uniform(.3),cameraFar:new s.Uniform(1e3),aspect:new s.Uniform(1),time:new s.Uniform(0)},blending:s.NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:o}]),e&&a.setShaderParts(e),n&&a.setDefines(n),i&&a.setUniforms(i),a.copyCameraSettings(r),a}return y(t,e),x(t,[{key:"inputBuffer",set:function(e){this.uniforms.inputBuffer.value=e}},{key:"setInputBuffer",value:function(e){this.uniforms.inputBuffer.value=e}},{key:"depthBuffer",get:function(){return this.uniforms.depthBuffer.value},set:function(e){this.uniforms.depthBuffer.value=e}},{key:"depthPacking",get:function(){return Number(this.defines.DEPTH_PACKING)},set:function(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}},{key:"setDepthBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.BasicDepthPacking;this.depthBuffer=e,this.depthPacking=t}},{key:"setShaderData",value:function(e){this.setShaderParts(e.shaderParts),this.setDefines(e.defines),this.setUniforms(e.uniforms),this.setExtensions(e.extensions)}},{key:"setShaderParts",value:function(e){return this.fragmentShader="#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#if DEPTH_PACKING == 3201\nuniform lowp sampler2D depthBuffer;\n#elif defined(GL_FRAGMENT_PRECISION_HIGH)\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <colorspace_fragment>\n#endif\n#include <dithering_fragment>\n}".replace(C.FRAGMENT_HEAD,e.get(C.FRAGMENT_HEAD)||"").replace(C.FRAGMENT_MAIN_UV,e.get(C.FRAGMENT_MAIN_UV)||"").replace(C.FRAGMENT_MAIN_IMAGE,e.get(C.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}".replace(C.VERTEX_HEAD,e.get(C.VERTEX_HEAD)||"").replace(C.VERTEX_MAIN_SUPPORT,e.get(C.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}},{key:"setDefines",value:function(e){var t,n=f(e.entries());try{for(n.s();!(t=n.n()).done;){var i=t.value;this.defines[i[0]]=i[1]}}catch(e){n.e(e)}finally{n.f()}return this.needsUpdate=!0,this}},{key:"setUniforms",value:function(e){var t,n=f(e.entries());try{for(n.s();!(t=n.n()).done;){var i=t.value;this.uniforms[i[0]]=i[1]}}catch(e){n.e(e)}finally{n.f()}return this}},{key:"setExtensions",value:function(e){this.extensions={};var t,n=f(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.extensions[i]=!0}}catch(e){n.e(e)}finally{n.f()}return this}},{key:"encodeOutput",get:function(){return void 0!==this.defines.ENCODE_OUTPUT},set:function(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}},{key:"isOutputEncodingEnabled",value:function(e){return this.encodeOutput}},{key:"setOutputEncodingEnabled",value:function(e){this.encodeOutput=e}},{key:"time",get:function(){return this.uniforms.time.value},set:function(e){this.uniforms.time.value=e}},{key:"setDeltaTime",value:function(e){this.uniforms.time.value+=e}},{key:"adoptCameraSettings",value:function(e){this.copyCameraSettings(e)}},{key:"copyCameraSettings",value:function(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof s.PerspectiveCamera?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},{key:"setSize",value:function(e,t){var n=this.uniforms;n.resolution.value.set(e,t),n.texelSize.value.set(1/e,1/t),n.aspect.value=e/t}}],[{key:"Section",get:function(){return C}}])}(s.ShaderMaterial),ei=(s.REVISION.replace(/\D+/g,""),255/256);function er(e,t,n){var i,r=f(t);try{for(r.s();!(i=r.n()).done;){var a,s=i.value,o="$1"+e+s.charAt(0).toUpperCase()+s.slice(1),u=RegExp("([^\\.])(\\b"+s+"\\b)","g"),l=f(n.entries());try{for(l.s();!(a=l.n()).done;){var c=a.value;null!==c[1]&&n.set(c[0],c[1].replace(u,o))}}catch(e){l.e(e)}finally{l.f()}}}catch(e){r.e(e)}finally{r.f()}}new Float32Array([255/256/16777216,255/256/65536,255/256/256,255/256]),new Float32Array([ei,ei/256,ei/65536,1/16777216]);var ea=function(e){function t(e){var n;g(this,t),(n=d(this,t,["EffectPass"])).fullscreenMaterial=new en(null,null,null,e),n.listener=function(e){return n.handleEvent(e)},n.effects=[];for(var i=arguments.length,r=Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return n.setEffects(r),n.skipRendering=!1,n.minTime=1,n.maxTime=Number.POSITIVE_INFINITY,n.timeScale=1,n}return y(t,e),x(t,[{key:"mainScene",set:function(e){var t,n=f(this.effects);try{for(n.s();!(t=n.n()).done;)t.value.mainScene=e}catch(e){n.e(e)}finally{n.f()}}},{key:"mainCamera",set:function(e){this.fullscreenMaterial.copyCameraSettings(e);var t,n=f(this.effects);try{for(n.s();!(t=n.n()).done;)t.value.mainCamera=e}catch(e){n.e(e)}finally{n.f()}}},{key:"encodeOutput",get:function(){return this.fullscreenMaterial.encodeOutput},set:function(e){this.fullscreenMaterial.encodeOutput=e}},{key:"dithering",get:function(){return this.fullscreenMaterial.dithering},set:function(e){var t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}},{key:"setEffects",value:function(e){var t,n=f(this.effects);try{for(n.s();!(t=n.n()).done;)t.value.removeEventListener("change",this.listener)}catch(e){n.e(e)}finally{n.f()}this.effects=e.sort(function(e,t){return t.attributes-e.attributes});var i,r=f(this.effects);try{for(r.s();!(i=r.n()).done;)i.value.addEventListener("change",this.listener)}catch(e){r.e(e)}finally{r.f()}}},{key:"updateMaterial",value:function(){var e,t=new F,n=0,i=f(this.effects);try{for(i.s();!(e=i.n()).done;){var r=e.value;if(r.blendMode.blendFunction===O.DST)t.attributes|=r.getAttributes()&z.DEPTH;else if((t.attributes&r.getAttributes()&z.CONVOLUTION)!=0)throw Error("Convolution effects cannot be merged (".concat(r.name,")"));else!function(e,t,n){var i=t.getFragmentShader(),r=t.getVertexShader(),a=void 0!==i&&/mainImage/.test(i),o=void 0!==i&&/mainUv/.test(i);if(n.attributes|=t.getAttributes(),void 0===i)throw Error("Missing fragment shader (".concat(t.name,")"));if(o&&(n.attributes&z.CONVOLUTION)!=0)throw Error("Effects that transform UVs are incompatible with convolution effects (".concat(t.name,")"));if(a||o){var u=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=n.shaderParts,c=l.get(C.FRAGMENT_HEAD)||"",h=l.get(C.FRAGMENT_MAIN_UV)||"",v=l.get(C.FRAGMENT_MAIN_IMAGE)||"",d=l.get(C.VERTEX_HEAD)||"",p=l.get(C.VERTEX_MAIN_SUPPORT)||"",y=new Set,m=new Set;if(o&&(h+="	".concat(e,"MainUv(UV);\n"),n.uvTransformation=!0),null!==r&&/mainSupport/.test(r)){var g=/mainSupport *\([\w\s]*?uv\s*?\)/.test(r);p+="	".concat(e,"MainSupport(")+(g?"vUv);\n":");\n");var S,x=f(r.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g));try{for(x.s();!(S=x.n()).done;){var T,w=S.value,k=f(w[1].split(/\s*,\s*/));try{for(k.s();!(T=k.n()).done;){var U=T.value;n.varyings.add(U),y.add(U),m.add(U)}}catch(e){k.e(e)}finally{k.f()}}}catch(e){x.e(e)}finally{x.f()}var E,b=f(r.matchAll(u));try{for(b.s();!(E=b.n()).done;){var B=E.value;m.add(B[1])}}catch(e){b.e(e)}finally{b.f()}}var R,A=f(i.matchAll(u));try{for(A.s();!(R=A.n()).done;){var M=R.value;m.add(M[1])}}catch(e){A.e(e)}finally{A.f()}var D,_=f(t.defines.keys());try{for(_.s();!(D=_.n()).done;){var F=D.value;m.add(F.replace(/\([\w\s,]*\)/g,""))}}catch(e){_.e(e)}finally{_.f()}var P,I=f(t.uniforms.keys());try{for(I.s();!(P=I.n()).done;){var N=P.value;m.add(N)}}catch(e){I.e(e)}finally{I.f()}m.delete("while"),m.delete("for"),m.delete("if"),t.uniforms.forEach(function(t,i){return n.uniforms.set(e+i.charAt(0).toUpperCase()+i.slice(1),t)}),t.defines.forEach(function(t,i){return n.defines.set(e+i.charAt(0).toUpperCase()+i.slice(1),t)});var O=new Map([["fragment",i],["vertex",r]]);er(e,m,n.defines),er(e,m,O),i=O.get("fragment"),r=O.get("vertex");var G=t.blendMode;if(n.blendModes.set(G.blendFunction,G),a){null!==t.inputColorSpace&&t.inputColorSpace!==n.colorSpace&&(v+=t.inputColorSpace===s.SRGBColorSpace?"color0 = sRGBTransferOETF(color0);\n	":"color0 = sRGBToLinear(color0);\n	"),t.outputColorSpace!==s.NoColorSpace?n.colorSpace=t.outputColorSpace:null!==t.inputColorSpace&&(n.colorSpace=t.inputColorSpace),v+="".concat(e,"MainImage(color0, UV, "),(n.attributes&z.DEPTH)!=0&&/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/.test(i)&&(v+="depth, ",n.readDepth=!0),v+="color1);\n	";var H=e+"BlendOpacity";n.uniforms.set(H,G.opacity),v+="color0 = blend".concat(G.blendFunction,"(color0, color1, ").concat(H,");\n\n	"),c+="uniform float ".concat(H,";\n\n")}if(c+=i+"\n",null!==r&&(d+=r+"\n"),l.set(C.FRAGMENT_HEAD,c),l.set(C.FRAGMENT_MAIN_UV,h),l.set(C.FRAGMENT_MAIN_IMAGE,v),l.set(C.VERTEX_HEAD,d),l.set(C.VERTEX_MAIN_SUPPORT,p),null!==t.extensions){var L,V=f(t.extensions);try{for(V.s();!(L=V.n()).done;){var W=L.value;n.extensions.add(W)}}catch(e){V.e(e)}finally{V.f()}}}else throw Error("Could not find mainImage or mainUv function (".concat(t.name,")"))}("e"+n++,r,t)}}catch(e){i.e(e)}finally{i.f()}var a,o=t.shaderParts.get(C.FRAGMENT_HEAD),u=t.shaderParts.get(C.FRAGMENT_MAIN_IMAGE),l=t.shaderParts.get(C.FRAGMENT_MAIN_UV),c=/\bblend\b/g,v=f(t.blendModes.values());try{for(v.s();!(a=v.n()).done;){var d=a.value;o+=d.getShaderCode().replace(c,"blend".concat(d.blendFunction))+"\n"}}catch(e){v.e(e)}finally{v.f()}(t.attributes&z.DEPTH)!=0?(t.readDepth&&(u="float depth = readDepth(UV);\n\n	"+u),this.needsDepthTexture=null===this.getDepthTexture()):this.needsDepthTexture=!1,t.colorSpace===s.SRGBColorSpace&&(u+="color0 = sRGBToLinear(color0);\n	"),t.uvTransformation?(l="vec2 transformedUv = vUv;\n"+l,t.defines.set("UV","transformedUv")):t.defines.set("UV","vUv"),t.shaderParts.set(C.FRAGMENT_HEAD,o),t.shaderParts.set(C.FRAGMENT_MAIN_IMAGE,u),t.shaderParts.set(C.FRAGMENT_MAIN_UV,l);var p,y=f(t.shaderParts);try{for(y.s();!(p=y.n()).done;){var m,g=(m=p.value,function(e){if(Array.isArray(e))return e}(m)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,s,o=[],u=!0,l=!1;try{a=(n=n.call(e)).next;for(;!(u=(i=a.call(n)).done)&&(o.push(i.value),o.length!==t);u=!0);}catch(e){l=!0,r=e}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw r}}return o}}(m,2)||h(m,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),S=g[0],x=g[1];null!==x&&t.shaderParts.set(S,x.trim().replace(/^#/,"\n#"))}}catch(e){y.e(e)}finally{y.f()}this.skipRendering=0===n,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(t)}},{key:"recompile",value:function(){this.updateMaterial()}},{key:"getDepthTexture",value:function(){return this.fullscreenMaterial.depthBuffer}},{key:"setDepthTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.BasicDepthPacking;this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;var n,i=f(this.effects);try{for(i.s();!(n=i.n()).done;)n.value.setDepthTexture(e,t)}catch(e){i.e(e)}finally{i.f()}}},{key:"render",value:function(e,t,n,i,r){var a,s=f(this.effects);try{for(s.s();!(a=s.n()).done;)a.value.update(e,t,i)}catch(e){s.e(e)}finally{s.f()}if(!this.skipRendering||this.renderToScreen){var o=this.fullscreenMaterial;o.inputBuffer=t.texture,o.time+=i*this.timeScale,e.setRenderTarget(this.renderToScreen?null:n),e.render(this.scene,this.camera)}}},{key:"setSize",value:function(e,t){this.fullscreenMaterial.setSize(e,t);var n,i=f(this.effects);try{for(i.s();!(n=i.n()).done;)n.value.setSize(e,t)}catch(e){i.e(e)}finally{i.f()}}},{key:"initialize",value:function(e,t,n){this.renderer=e;var i,r=f(this.effects);try{for(r.s();!(i=r.n()).done;)i.value.initialize(e,t,n)}catch(e){r.e(e)}finally{r.f()}this.updateMaterial(),void 0!==n&&n!==s.UnsignedByteType&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},{key:"dispose",value:function(){l(p(t.prototype),"dispose",this).call(this);var e,n=f(this.effects);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.removeEventListener("change",this.listener),i.dispose()}}catch(e){n.e(e)}finally{n.f()}}},{key:"handleEvent",value:function(e){"change"===e.type&&this.recompile()}}])}(U),es=function(e){function t(e,n){var i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.renderTarget,o=r.resolutionScale,u=r.width,l=void 0===u?N.AUTO_SIZE:u,c=r.height,f=void 0===c?N.AUTO_SIZE:c,h=r.resolutionX,v=r.resolutionY;g(this,t),(i=d(this,t,["NormalPass"])).needsSwap=!1,i.renderPass=new J(e,n,new s.MeshNormalMaterial);var p=i.renderPass;p.ignoreBackground=!0,p.skipShadowMapUpdate=!0;var y=p.getClearPass();y.overrideClearColor=new s.Color(7829503),y.overrideClearAlpha=1,i.renderTarget=a,void 0===i.renderTarget&&(i.renderTarget=new s.WebGLRenderTarget(1,1,{minFilter:s.NearestFilter,magFilter:s.NearestFilter}),i.renderTarget.texture.name="NormalPass.Target");var m=i.resolution=new N(i,void 0===h?l:h,void 0===v?f:v,void 0===o?1:o);return m.addEventListener("change",function(e){return i.setSize(m.baseWidth,m.baseHeight)}),i}return y(t,e),x(t,[{key:"mainScene",set:function(e){this.renderPass.mainScene=e}},{key:"mainCamera",set:function(e){this.renderPass.mainCamera=e}},{key:"texture",get:function(){return this.renderTarget.texture}},{key:"getTexture",value:function(){return this.renderTarget.texture}},{key:"getResolution",value:function(){return this.resolution}},{key:"getResolutionScale",value:function(){return this.resolution.scale}},{key:"setResolutionScale",value:function(e){this.resolution.scale=e}},{key:"render",value:function(e,t,n,i,r){var a=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,a,a)}},{key:"setSize",value:function(e,t){var n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}}])}(U);new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array(2),new Float32Array(2),new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125]),new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4]),new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3]);function eo(e,t,n,i){var r;return(r=e+(t-e)*.75)+(n+(i-n)*.75-r)*.875}eo(0,0,0,0),new Float32Array([0,0,0,0]),eo(0,0,0,1),new Float32Array([0,0,0,1]),eo(0,0,1,0),new Float32Array([0,0,1,0]),eo(0,0,1,1),new Float32Array([0,0,1,1]),eo(0,1,0,0),new Float32Array([0,1,0,0]),eo(0,1,0,1),new Float32Array([0,1,0,1]),eo(0,1,1,0),new Float32Array([0,1,1,0]),eo(0,1,1,1),new Float32Array([0,1,1,1]),eo(1,0,0,0),new Float32Array([1,0,0,0]),eo(1,0,0,1),new Float32Array([1,0,0,1]),eo(1,0,1,0),new Float32Array([1,0,1,0]),eo(1,0,1,1),new Float32Array([1,0,1,1]),eo(1,1,0,0),new Float32Array([1,1,0,0]),eo(1,1,0,1),new Float32Array([1,1,0,1]),eo(1,1,1,0),new Float32Array([1,1,1,0]),eo(1,1,1,1),new Float32Array([1,1,1,1])}}]);